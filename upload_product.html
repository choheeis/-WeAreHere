<html>

<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="resetCSS.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:400,500,700&display=swap&subset=korean" rel="stylesheet">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="http://code.jquery.com/jquery-3.1.1.js"></script>
    <!--<script src="file_dropdown.js" type="text/javascript"></script>-->

    <style>
        .dropboxEF {
            
            
            background-color: rgba(187, 255, 255, 0.56);



            color: #ffffff;
        }
        
        #dropbox {
            position: relative;
            top:-300px;
        }

        #drop {
            width: 800px;
            height: auto;
            min-height: 300px;
            padding: 3px;
            background-color: rgba(187, 255, 255, 0.56);
        }

        .drag-over {
            background-color: #ff0;
        }

        .container {
            width: 215px;
            height: 215px;
            padding: 10px;
            display: inline-block;
            background-color: ;
            vertical-align: top;
        }

        .thumb {
            width: 215px;
            height: 215px;
            padding: 10px;
            display: inline-block;
            background-color: ;
            vertical-align: top;
        }

        .thumb>img {
            padding-left: 15px;
            padding-top: 15px;

        }

        .thumb>.close {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 10px;
            background-color: dimgray;
            color: white;
            text-align: center;
            font-size: 15px;
            line-height: 20px;
            cursor: pointer;
        }

        .thumb>.close:hover {
            width: 23px;
            height: 23px;
            border-radius: 15px;
            line-height: 23px;
        }
    </style>

    <script>
        $(document).ready(function() {

            isFile();
            var $drop = $("#drop");

            $drop.on("dragenter", function(e) { //드래그 요소가 들어왔을떄

                $(this).addClass('drag-over');

            }).on("dragleave", function(e) { //드래그 요소가 나갔을때

                $(this).removeClass('drag-over');

            }).on("dragover", function(e) {

                e.stopPropagation();

                e.preventDefault();

            }).on('drop', function(e) { //드래그한 항목을 떨어뜨렸을때

                e.preventDefault();

                $(this).removeClass('drag-over');


                var files = e.originalEvent.dataTransfer.files; //드래그&드랍 항목


                for (var i = 0; i < files.length; i++) {

                    var file = files[i];

                    var size = uploadFiles.push(file); //업로드 목록에 추가

                    preview(file, size - 1); //미리보기 만들기

                }



                $("#btnSubmit").on("click", function() {

                    var formData = new FormData();

                    $.each(uploadFiles, function(i, file) {

                        if (file.upload != 'disable') //삭제하지 않은 이미지만 업로드 항목으로 추가

                            formData.append('upload-file', file, file.name);

                    });


                    $.ajax({

                        url: '/api/etc/file/upload',

                        data: formData,

                        type: 'post',

                        contentType: false,

                        processData: false,

                        success: function(ret) {

                            alert("완료");

                        }

                    });

                });


                $("#thumbnails").on("click", ".close", function(e) {

                    var $target = $(e.target);

                    var idx = $target.attr('data-idx');

                    uploadFiles[idx].upload = 'disable'; //삭제된 항목은 업로드하지 않기 위해 플래그 생성

                    $target.parent().remove(); //프리뷰 삭제
                    isFile();
                });
            });
        });
        var uploadFiles = [];

        function preview(file, idx) {

            var reader = new FileReader();

            reader.onload = (function(f, idx) {

                return function(e) {
                    //var $thum_ct = $('<div></div>');
                    var $thum_div = $('<div></div>');
                    var $thum_close = $('<div>X</div>');
                    var $thum_img = $('<img>');

                    //$thum_ct.addClass('container');
                    $thum_div.addClass('thumb');
                    $thum_close.addClass('close');
                    $thum_close.attr('data-idx', idx);
                    $thum_img.attr({
                        src: e.target.result,
                        title: escape(f.name)
                    });

                    $thum_div.append($thum_close);
                    $thum_div.append($thum_img);
                    //$thum_ct.append($thum_div);

                    //$('#thumbnails').append($thum_ct);
                    $('#thumbnails').append($thum_div);
                    resize($thum_img);
                    isFile();
                };

            })(file, idx);
            reader.readAsDataURL(file);


        };

        function resize(last_prv) {
            var maxWidth = 200;
            var maxHeight = 200;
            var ratio = 0;
            var width = $(last_prv).width();
            var height = $(last_prv).height();
            console.log('h = ' + height + ' w = ' + width);

            if (width > maxWidth) {
                console.log('width processing');
                ratio = maxWidth / width;
                //console.log('ratio = ' + ratio);
                $(last_prv).css('width', maxWidth);
                $(last_prv).css('height', height * ratio);
                height = height * ratio;
                //console.log('h = ' + $(last_prv).css('height') + ' w = ' + $(last_prv).css('width'));
            }

            var width = $(last_prv).width();
            var height = $(last_prv).height();

            if (height > maxHeight) {
                console.log('height processing');
                ratio = maxHeight / height;
                //console.log('ratio = ' + ratio);
                $(last_prv).css('height', maxHeight);
                $(last_prv).css('width', width * ratio);
                width = width * ratio;
                //console.log('h = ' + $(last_prv).css('height') + ' w = ' + $(last_prv).css('width'));
            }
        }

        function isFile() {
            if ($('#thumbnails').children().length == 0) {
                $('#drop').css('background-color', 'rgba(187, 255, 255, 0.56)');
                $('#drop').html('파일을 드롭 앤 드롭하여 첨부');
            } else {
                $('#drop').css('background-color', '');
                $('#drop').html('');
            }

        }
    </script>


</head>

<body>
    <div id="wrap">
        <div class="headbox">
            <div class="inheadbox">
                <div class="logo">
                    <p>#WE ARE HERE</p>
                </div>
                <div class="search">
                    <form>
                        <input class="searchbox" type="text" name="search" value="" />
                    </form>
                </div>
            </div>
        </div>
        <div id="bodybox">
            <div class="content">
               
                <div id="drop">
                    <div id="thumbnails"></div>
                </div>
                <div id="dropbox"></div>
                
            </div>
        </div>
    </div>
</body></html>
